!function(){"use strict";app=app||{},app.Signup=Backbone.Model.extend({url:"/signup/",defaults:{errors:[],errfor:{},username:"",email:"",password:""}}),app.SignupView=Backbone.View.extend({el:"#signup",template:_.template($("#tmpl-signup").html()),events:{"submit form":"createStripeToken"},initialize:function(){this.model=new app.Signup,this.listenTo(this.model,"sync",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes)),this.$el.find('[name="username"]').focus()},createStripeToken:function(a){a.preventDefault(),Stripe.setPublishableKey("pk_test_4MT0GF18tCIve3NiwrXEhIvK");var b=this.$("#payment-form");b.find("button").prop("disabled",!0),Stripe.card.createToken(b,this.stripeResponseHandler.bind(this))},stripeResponseHandler:function(a,b){var c=$("#payment-form");if(b.error)c.find(".payment-errors").text(b.error.message),c.find("button").prop("disabled",!1);else{var d=b.id;c.append($('<input type="hidden" name="stripeToken" />').val(d)),this.signup()}},signup:function(){this.$el.find(".btn-signup").attr("disabled",!0),this.model.save({username:this.$el.find('[name="username"]').val(),email:this.$el.find('[name="email"]').val(),password:this.$el.find('[name="password"]').val(),stripeToken:this.$el.find('[name="stripeToken"]').val()},{success:function(a,b){b.success?location.href="/account/":a.set(b)}})}}),$(document).ready(function(){app.signupView=new app.SignupView})}();
//# sourceMappingURL=indexwithstripe.min.js.map